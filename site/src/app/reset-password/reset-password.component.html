<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
      <div class="card shadow">
        <div class="card-body p-4">
          <h3 class="card-title text-center mb-4">Đặt lại mật khẩu</h3>
          <p class="text-muted text-center mb-4">
            Vui lòng nhập mật khẩu mới cho tài khoản <strong>{{ email }}</strong>
          </p>

          <form #resetForm="ngForm" (ngSubmit)="onSubmit()">
            <!-- Hidden OTP field (for form validation) -->
            <input type="hidden" name="otp" [(ngModel)]="otp" required>

            <!-- New Password -->
            <div class="mb-3">
              <label for="newPassword" class="form-label">Mật khẩu mới</label>
              <input
                type="password"
                class="form-control form-control-lg"
                id="newPassword"
                name="newPassword"
                [(ngModel)]="newPassword"
                #newPass="ngModel"
                placeholder="Nhập mật khẩu mới"
                required
                minlength="6"
                [disabled]="isLoading"
              >
              <div class="form-text">Mật khẩu phải có ít nhất 6 ký tự</div>
              <div *ngIf="newPass.invalid && newPass.touched" class="invalid-feedback d-block">
                Vui lòng nhập mật khẩu mới
              </div>
            </div>

            <!-- Confirm Password -->
            <div class="mb-4">
              <label for="confirmPassword" class="form-label">Xác nhận mật khẩu</label>
              <input
                type="password"
                class="form-control form-control-lg"
                id="confirmPassword"
                name="confirmPassword"
                [(ngModel)]="confirmPassword"
                #confirmPass="ngModel"
                placeholder="Nhập lại mật khẩu mới"
                required
                [disabled]="isLoading"
              >
              <div *ngIf="passwordMismatch" class="invalid-feedback d-block">
                Mật khẩu xác nhận không khớp
              </div>
            </div>

            <!-- Error Message -->
            <div *ngIf="errorMessage" class="alert alert-danger">
              {{ errorMessage }}
            </div>

            <!-- Success Message -->
            <div *ngIf="successMessage" class="alert alert-success">
              {{ successMessage }}
            </div>

            <!-- Submit Button -->
            <div class="d-grid gap-2">
              <button 
                type="submit" 
                class="btn btn-primary btn-lg"
                [disabled]="!isFormValid || isLoading"
              >
                <span *ngIf="!isLoading">Đặt lại mật khẩu</span>
                <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                <span *ngIf="isLoading"> Đang xử lý...</span>
              </button>
            </div>

            <!-- Back to login -->
            <div class="text-center mt-4">
              <a [routerLink]="['/dangnhap']" class="text-decoration-none">
                <i class="bi bi-arrow-left"></i> Quay lại đăng nhập
              </a>
            </div>
          </form>

      <p *ngIf="successMessage" class="text-success text-center mt-3">
        {{ successMessage }}
      </p>
      <p *ngIf="errorMessage" class="text-danger text-center mt-3">
        {{ errorMessage }}
      </p>
    </div>
  </div>
</div>
