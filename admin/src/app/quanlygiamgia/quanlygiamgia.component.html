<div class="app-container">
  <!-- SVG ICONS template -->
  <svg style="display: none;">
    <symbol id="menu-dashboard" viewBox="0 0 24 24">
      <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
    </symbol>
    <symbol id="menu-list" viewBox="0 0 24 24">
      <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
    </symbol>
    <symbol id="menu-product" viewBox="0 0 24 24">
      <path d="M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"/>
    </symbol>
    <symbol id="menu-customer" viewBox="0 0 24 24">
      <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
    </symbol>
    <symbol id="menu-order" viewBox="0 0 24 24">
      <path d="M13 12h7v1.5h-7V12zm0-2.5h7V11h-7V9.5zm7 5h-7V16h7v-1.5zM19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z"/>
    </symbol>
    <symbol id="menu-comment" viewBox="0 0 24 24">
      <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
    </symbol>
    <symbol id="menu-discount" viewBox="0 0 24 24">
      <path d="M12.79 21L3 11.21v2c0 .53.21 1.04.59 1.41l7.79 7.79c.78.78 2.05.78 2.83 0l6.21-6.21c.78-.78.78-2.05 0-2.83L12.79 21z"/>
      <path d="M3 9.21v2c0 .53.21 1.04.59 1.41l7.79 7.79c.78.78 2.05.78 2.83 0l6.21-6.21c.78-.78.78-2.05 0-2.83L12.79 1.41A1.996 1.996 0 0 0 11.21 1H5c-1.1 0-2 .9-2 2v6.21zM7.5 8C6.67 8 6 7.33 6 6.5S6.67 5 7.5 5 9 5.67 9 6.5 8.33 8 7.5 8z"/>
    </symbol>
    <symbol id="logout-icon" viewBox="0 0 24 24">
      <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
    </symbol>
    <symbol id="search-icon" viewBox="0 0 24 24">
      <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    </symbol>
  </svg>
  <aside class="sidebar">
    <div class="logo">
      <span class="logo-text"><img src="/images/logo.png" width="100px"></span>
    </div>
    <nav class="sidebar-menu">
      <a class="menu-item" [routerLink]="['/thongke']"><span class="icon menu-dashboard"></span> Bảng điều khiển</a>
      <a class="menu-item" [routerLink]="['/quanlydanhmuc']"><span class="icon menu-list"></span> Danh mục</a>
      <a class="menu-item" [routerLink]="['/quanlysanpham']"><span class="icon menu-product"></span> Sản phẩm</a>
      <a class="menu-item" [routerLink]="['/quanlynguoidung']"><span class="icon menu-customer"></span> Khách hàng</a>
      <a class="menu-item" [routerLink]="['/quanlydonhang']"><span class="icon menu-order"></span> Đơn hàng</a>
      <a class="menu-item active" [routerLink]="['/quanlygiamgia']"><span class="icon menu-discount"></span> Chương trình giảm giá</a>
      <a class="menu-item" [routerLink]="['/quanlybinhluan']"><span class="icon menu-comment"></span> Bình luận</a>
    </nav>
    <div class="sidebar-bottom">
      <a class="logout" (click)="logout()"><svg class="logout-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><use xlink:href="#logout-icon"></use></svg> Đăng xuất</a>
    </div>
  </aside>

  <div class="main-container">
    <header class="main-header">
      <div class="header-left">
        <div class="page-title">Quản lý chương trình giảm giá</div>
        <div class="breadcrumb">Home / Chương trình giảm giá</div>
      </div>
      <div class="header-right">
        <div class="search-box">
          <span class="icon search-icon"></span>
          <input type="text" placeholder="Tìm kiếm mã giảm giá" [(ngModel)]="searchQuery" (input)="search()" />
        </div>
        <img class="avatar" src="/images/avt.png" alt="avatar">
      </div>
    </header>

    <main class="dashboard-content">
      <div *ngIf="errorMessage" class="alert alert-danger">
        {{ errorMessage }}
      </div>

      <div *ngIf="successMessage" class="alert alert-success">
        {{ successMessage }}
      </div>

      <div class="section-header">
        <h2>Danh sách mã giảm giá</h2>
        <button class="add-button" (click)="showAddForm()" [disabled]="loading">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Thêm mã giảm giá
        </button>
      </div>

      <!-- Add/Edit Form -->
      <div class="form-overlay" *ngIf="showForm">
        <div class="form-container">
          <div class="form-header">
            <h3>{{ isEditing ? 'Chỉnh sửa mã giảm giá' : 'Thêm mã giảm giá mới' }}</h3>
            <button class="btn-close" (click)="hideForm()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
          </div>

          <form (ngSubmit)="saveDiscount()" #discountForm="ngForm">
            <div class="form-row">
              <div class="form-group">
                <label for="code">Mã giảm giá *</label>
                <input 
                  type="text" 
                  id="code" 
                  name="code" 
                  [(ngModel)]="newDiscount.code" 
                  required 
                  placeholder="VD: WELCOME10"
                  [disabled]="loading">
              </div>
              <div class="form-group">
                <label for="name">Tên mã giảm giá *</label>
                <input 
                  type="text" 
                  id="name" 
                  name="name" 
                  [(ngModel)]="newDiscount.name" 
                  required 
                  placeholder="VD: Giảm giá chào mừng"
                  [disabled]="loading">
              </div>
            </div>

            <div class="form-group">
              <label for="description">Mô tả</label>
              <textarea 
                id="description" 
                name="description" 
                [(ngModel)]="newDiscount.description" 
                placeholder="Mô tả chi tiết về mã giảm giá"
                [disabled]="loading"></textarea>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="discountType">Loại giảm giá *</label>
                <select 
                  id="discountType" 
                  name="discountType" 
                  [(ngModel)]="newDiscount.discountType" 
                  required
                  [disabled]="loading">
                  <option value="percentage">Phần trăm (%)</option>
                  <option value="fixed">Số tiền cố định (VNĐ)</option>
                </select>
              </div>
              <div class="form-group">
                <label for="discountValue">Giá trị giảm giá *</label>
                <input 
                  type="number" 
                  id="discountValue" 
                  name="discountValue" 
                  [(ngModel)]="newDiscount.discountValue" 
                  required 
                  [min]="0"
                  [max]="newDiscount.discountType === 'percentage' ? 100 : null"
                  [placeholder]="newDiscount.discountType === 'percentage' ? 'VD: 10' : 'VD: 50000'"
                  [disabled]="loading">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="minOrderValue">Giá trị đơn hàng tối thiểu</label>
                <input 
                  type="number" 
                  id="minOrderValue" 
                  name="minOrderValue" 
                  [(ngModel)]="newDiscount.minOrderValue" 
                  [min]="0"
                  placeholder="VD: 500000"
                  [disabled]="loading">
              </div>
              <div class="form-group" *ngIf="newDiscount.discountType === 'percentage'">
                <label for="maxDiscount">Giảm giá tối đa</label>
                <input 
                  type="number" 
                  id="maxDiscount" 
                  name="maxDiscount" 
                  [(ngModel)]="newDiscount.maxDiscount" 
                  [min]="0"
                  placeholder="VD: 100000"
                  [disabled]="loading">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="startDate">Ngày bắt đầu *</label>
                <input 
                  type="datetime-local" 
                  id="startDate" 
                  name="startDate" 
                  [(ngModel)]="newDiscount.startDate" 
                  required
                  [disabled]="loading">
              </div>
              <div class="form-group">
                <label for="endDate">Ngày kết thúc *</label>
                <input 
                  type="datetime-local" 
                  id="endDate" 
                  name="endDate" 
                  [(ngModel)]="newDiscount.endDate" 
                  required
                  [disabled]="loading">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="usageLimit">Giới hạn sử dụng</label>
                <input 
                  type="number" 
                  id="usageLimit" 
                  name="usageLimit" 
                  [(ngModel)]="newDiscount.usageLimit" 
                  [min]="0"
                  placeholder="VD: 100 (0 = không giới hạn)"
                  [disabled]="loading">
              </div>
              <div class="form-group">
                <label class="checkbox-label">
                  <input 
                    type="checkbox" 
                    [(ngModel)]="newDiscount.isActive" 
                    name="isActive"
                    [disabled]="loading">
                  <span class="checkmark"></span>
                  Kích hoạt mã giảm giá
                </label>
              </div>
            </div>

            <!-- Chọn sản phẩm áp dụng -->
            <div class="form-group">
              <label>Sản phẩm áp dụng</label>
              <div class="selection-container">
                <div class="selected-items">
                  <div class="selected-item" *ngFor="let product of selectedProducts">
                    <span class="item-name">{{ product.name }}</span>
                    <button type="button" class="btn-remove" (click)="removeProduct(product._id!)">
                      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                    </button>
                  </div>
                  <div class="selected-item" *ngFor="let category of selectedCategories">
                    <span class="item-name">Danh mục: {{ category.name }}</span>
                    <button type="button" class="btn-remove" (click)="removeCategory(category._id!)">
                      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                    </button>
                  </div>
                  <div class="no-items" *ngIf="selectedProducts.length === 0 && selectedCategories.length === 0">
                    Chưa chọn sản phẩm hoặc danh mục nào
                  </div>
                </div>
                <div class="selection-buttons">
                  <button type="button" class="btn-select" (click)="showProductSelectionModal()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <line x1="12" y1="5" x2="12" y2="19"></line>
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Chọn sản phẩm
                  </button>
                  <button type="button" class="btn-select" (click)="showCategorySelectionModal()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                      <line x1="12" y1="11" x2="12" y2="17"></line>
                      <line x1="9" y1="14" x2="15" y2="14"></line>
                    </svg>
                    Chọn danh mục
                  </button>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn-cancel" (click)="hideForm()" [disabled]="loading">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
                Hủy bỏ
              </button>
              <button type="submit" class="btn-save" [disabled]="loading || !discountForm.form.valid">
                <span *ngIf="loading">
                  <svg class="spinner" width="16" height="16" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="4" stroke-dasharray="31.4 31.4">
                      <animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite"/>
                    </circle>
                  </svg>
                </span>
                <span *ngIf="!loading">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                    <polyline points="17 21 17 13 7 13 7 21"></polyline>
                    <polyline points="7 3 7 8 15 8"></polyline>
                  </svg>
                  {{ isEditing ? 'Cập nhật' : 'Thêm mới' }}
                </span>
              </button>
            </div>
          </form>
        </div>
      </div>
      <!-- Discount List -->
      <div class="content">
        <div class="loading" *ngIf="loading && !showForm">
          <div class="spinner"></div>
          <p>Đang tải dữ liệu...</p>
        </div>

        <ng-container *ngIf="!loading && filteredDiscounts.length > 0">
          <div class="discount-list">
            <ng-container *ngFor="let discount of filteredDiscounts">
              <div class="discount-item">
                <div class="discount-header">
                  <div class="discount-code">
                    <h4>{{ discount.code }}</h4>
                    <span class="discount-name">{{ discount.name }}</span>
                  </div>
                  <div class="action-buttons">
                    <button 
                      class="action-button" 
                      [class.view-button]="discount.isActive"
                      [class.hide-button]="!discount.isActive"
                      (click)="toggleActive(discount)"
                      [disabled]="loading"
                      type="button">
                      <ng-container *ngIf="discount.isActive; else inactiveIcon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                          <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                        <span>Hoạt động</span>
                      </ng-container>
                      <ng-template #inactiveIcon>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M18 6L6 18"></path>
                          <path d="M6 6l12 12"></path>
                        </svg>
                        <span>Vô hiệu</span>
                      </ng-template>
                    </button>
                    <button 
                      class="action-button edit-button" 
                      (click)="showEditForm(discount)" 
                      [disabled]="loading"
                      title="Chỉnh sửa"
                      type="button">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                      </svg>
                      <span>Sửa</span>
                    </button>
                    <button 
                      class="action-button delete-button" 
                      (click)="deleteDiscount(discount._id || '')" 
                      [disabled]="loading"
                      title="Xóa"
                      type="button">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                      </svg>
                      <span>Xóa</span>
                    </button>
                  </div>
                </div>
                
                <div class="discount-details">
                  <div class="detail-row">
                    <div class="detail-item">
                      <span class="label">Mô tả:</span>
                      <span class="value">{{ discount.description || 'Không có mô tả' }}</span>
                    </div>
                  </div>
                  
                  <div class="detail-row">
                    <div class="detail-item">
                      <span class="label">Loại giảm giá:</span>
                      <span class="value">{{ getDiscountTypeText(discount.discountType) }}</span>
                    </div>
                    <div class="detail-item">
                      <span class="label">Giá trị:</span>
                      <span class="value">
                        {{ discount.discountType === 'percentage' ? discount.discountValue + '%' : formatCurrency(discount.discountValue) }}
                      </span>
                    </div>
                  </div>
                  
                  <div class="detail-row">
                    <div class="detail-item">
                      <span class="label">Đơn hàng tối thiểu:</span>
                      <span class="value">{{ formatCurrency(discount.minOrderValue) }}</span>
                    </div>
                    <div class="detail-item" *ngIf="discount.maxDiscount">
                      <span class="label">Giảm tối đa:</span>
                      <span class="value">{{ formatCurrency(discount.maxDiscount) }}</span>
                    </div>
                  </div>
                  
                  <div class="detail-row">
                    <div class="detail-item">
                      <span class="label">Thời hạn:</span>
                      <span class="value">{{ formatDate(discount.startDate) }} - {{ formatDate(discount.endDate) }}</span>
                    </div>
                    <div class="detail-item">
                      <span class="label">Đã sử dụng:</span>
                      <span class="value">{{ discount.usedCount }}/{{ discount.usageLimit || '∞' }}</span>
                    </div>
                  </div>
                  
                  <div class="detail-row">
                    <div class="detail-item">
                      <span class="label">Trạng thái:</span>
                      <span class="value" [class]="getStatusClass(discount.isActive)">
                        {{ getStatusText(discount.isActive) }}
                      </span>
                    </div>
                  </div>
                  
                  <div class="detail-row" *ngIf="discount.applicableProducts.length > 0 || discount.applicableCategories.length > 0">
                    <div class="detail-item">
                      <span class="label">Áp dụng cho:</span>
                      <div class="applicable-items">
                        <span class="applicable-count" *ngIf="discount.applicableProducts.length > 0">
                          {{ discount.applicableProducts.length }} sản phẩm
                        </span>
                        <span class="applicable-count" *ngIf="discount.applicableCategories.length > 0">
                          {{ discount.applicableCategories.length }} danh mục
                        </span>
                      </div>
                    </div>
                  </div>
                  
                  <div class="detail-row" *ngIf="discount.applicableProducts.length > 0">
                    <div class="detail-item full-width">
                      <span class="label">Sản phẩm áp dụng:</span>
                      <div class="product-tags">
                        <span class="product-tag" *ngFor="let productId of discount.applicableProducts">
                          {{ getProductName(productId) }}
                        </span>
                      </div>
                    </div>
                  </div>
                  
                  <div class="detail-row" *ngIf="discount.applicableCategories.length > 0">
                    <div class="detail-item full-width">
                      <span class="label">Danh mục áp dụng:</span>
                      <div class="category-tags">
                        <span class="category-tag" *ngFor="let categoryId of discount.applicableCategories">
                          {{ getCategoryName(categoryId) }}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </ng-container>
          </div>
        </ng-container>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="!loading && filteredDiscounts.length === 0">
          <div class="empty-icon">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#b3b8c5" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
          </div>
          <h3>Không có mã giảm giá nào</h3>
          <p>Bạn chưa tạo mã giảm giá nào. Hãy tạo mã giảm giá mới để bắt đầu.</p>
          <button class="btn-add" (click)="showAddForm()" type="button">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Thêm mã giảm giá
          </button>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- SVG ICONS template -->
<svg style="display: none;">
  <symbol id="menu-dashboard" viewBox="0 0 24 24">
    <rect x="3" y="3" width="7" height="7" rx="2" fill="#b3b8c5"/>
    <rect x="3" y="14" width="7" height="7" rx="2" fill="#b3b8c5"/>
    <rect x="14" y="3" width="7" height="7" rx="2" fill="#b3b8c5"/>
    <rect x="14" y="14" width="7" height="7" rx="2" fill="#b3b8c5"/>
  </symbol>
  <symbol id="menu-list" viewBox="0 0 24 24">
    <rect x="4" y="7" width="16" height="2" rx="1" fill="#b3b8c5"/>
    <rect x="4" y="11" width="16" height="2" rx="1" fill="#b3b8c5"/>
    <rect x="4" y="15" width="16" height="2" rx="1" fill="#b3b8c5"/>
  </symbol>
  <symbol id="menu-product" viewBox="0 0 24 24">
    <circle cx="12" cy="12" r="6" stroke="#b3b8c5" stroke-width="2" fill="none"/>
  </symbol>
  <symbol id="menu-customer" viewBox="0 0 24 24">
    <circle cx="12" cy="9" r="5" stroke="#b3b8c5" stroke-width="2" fill="none"/>
    <path d="M3 21c0-4.418 4.03-8 9-8s9 3.582 9 8" stroke="#b3b8c5" stroke-width="2" fill="none"/>
  </symbol>
  <symbol id="menu-order" viewBox="0 0 24 24">
    <rect x="6" y="6" width="12" height="12" rx="2" stroke="#b3b8c5" stroke-width="2" fill="none"/>
  </symbol>
  <symbol id="menu-comment" viewBox="0 0 24 24">
    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="#b3b8c5" stroke-width="2" fill="none"/>
  </symbol>
  <symbol id="logout-icon" viewBox="0 0 24 24">
    <path d="M16 17l5-5-5-5M21 12H9M13 7V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-2" stroke="#b3b8c5" stroke-width="2" fill="none"/>
  </symbol>
  <symbol id="search-icon" viewBox="0 0 24 24">
    <circle cx="11" cy="11" r="8" stroke="#b3b8c5" stroke-width="2" fill="none"/>
    <line x1="21" y1="21" x2="16.65" y2="16.65" stroke="#b3b8c5" stroke-width="2"/>
  </symbol>
</svg>

<!-- Modal chọn sản phẩm -->
<!-- Product Selection Modal -->
<div class="modal-overlay" *ngIf="showProductModal" (click)="hideProductModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Chọn sản phẩm áp dụng</h3>
      <button type="button" class="btn-close" (click)="hideProductModal()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    
    <div class="modal-search">
      <input 
        type="text" 
        placeholder="Tìm kiếm sản phẩm..." 
        [(ngModel)]="productSearchQuery" 
        (input)="searchProducts()"
        class="search-input">
    </div>
    
    <div class="modal-content">
      <div class="product-list">
        <div class="product-item" *ngFor="let product of filteredProducts" (click)="selectProduct(product)">
          <div class="product-info">
            <img [src]="product.thumbnail || '/images/default-product.png'" [alt]="product.name" class="product-thumbnail">
            <div class="product-details">
              <h4>{{ product.name }}</h4>
              <p class="product-price">{{ formatCurrency(product.price) }}</p>
            </div>
          </div>
          <div class="product-check" *ngIf="isProductSelected(product._id)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
          </div>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button type="button" class="btn-cancel" (click)="hideProductModal()">Đóng</button>
    </div>
  </div>
</div>

<!-- Category Selection Modal -->
<div class="modal-overlay" *ngIf="showCategoryModal" (click)="hideCategoryModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Chọn danh mục áp dụng</h3>
      <button type="button" class="btn-close" (click)="hideCategoryModal()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    
    <div class="modal-search">
      <input 
        type="text" 
        placeholder="Tìm kiếm danh mục..." 
        [(ngModel)]="categorySearchQuery" 
        (input)="searchCategories()"
        class="search-input">
    </div>
    
    <div class="modal-content">
      <div class="category-list">
        <div class="category-item" *ngFor="let category of filteredCategories" (click)="selectCategory(category)">
          <div class="category-info">
            <img [src]="category.image || '/images/default-category.png'" [alt]="category.name" class="category-thumbnail">
            <div class="category-details">
              <h4>{{ category.name }}</h4>
            </div>
          </div>
          <div class="category-check" *ngIf="isCategorySelected(category._id)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
          </div>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button type="button" class="btn-cancel" (click)="hideCategoryModal()">Đóng</button>
    </div>
  </div>
</div>
